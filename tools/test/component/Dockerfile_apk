ARG PHP_VERSION
FROM php:${PHP_VERSION}-cli-alpine

RUN ls -1 /etc/*release | xargs -i sh -c 'echo {} && cat {}'

RUN apk update \
    && apk add \
        bash \
        git \
        logrotate \
        perl-utils \
        postgresql-dev \
        procps \
        rsyslog

RUN docker-php-ext-install \
        mysqli \
        pgsql \
        zip

COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

ADD . /repo_root
WORKDIR /repo_root

ENTRYPOINT exec /repo_root/tools/test/component/docker_entrypoint.sh
